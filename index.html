<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Study Buddy</title>
  <style>
    :root {
      --bg: #0f172a;
      --bg-soft: #020617;
      --card-bg: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --accent-2: #a855f7;
      --border-subtle: #1f2937;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --danger: #f97373;
      --success: #4ade80;
      --radius-lg: 18px;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.9);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #1e293b 0, #020617 40%, #000 100%);
      color: var(--text-main);
      padding: 24px;
    }

    .app {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* HEADER */

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 24px;
      padding: 16px 20px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(56, 189, 248, 0.18), rgba(168, 85, 247, 0.22));
      border: 1px solid rgba(148, 163, 184, 0.4);
      backdrop-filter: blur(18px);
      box-shadow: 0 14px 35px rgba(15, 23, 42, 0.75);
    }

    .logo-row {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-circle {
      width: 54px;
      height: 54px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #e0f2fe 0, #0369a1 40%, #020617 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.9);
      border: 2px solid rgba(248, 250, 252, 0.7);
    }

    .logo-circle span {
      font-size: 2rem;
    }

    .app-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .app-title h1 {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .app-title p {
      font-size: 0.9rem;
      color: #e5e7eb;
    }

    .header-points {
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
    }

    .header-points span:first-child {
      font-size: 1.1rem;
    }

    .chip {
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    /* LAYOUT */

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 18px;
    }

    @media (max-width: 960px) {
      .grid {
        grid-template-columns: 1fr;
      }

      header {
        border-radius: 18px;
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent 55%),
        radial-gradient(circle at bottom right, rgba(168, 85, 247, 0.16), transparent 55%),
        var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 16px 18px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        135deg,
        rgba(148, 163, 184, 0.22),
        transparent 20%,
        transparent 80%,
        rgba(148, 163, 184, 0.15)
      );
      opacity: 0.2;
      pointer-events: none;
    }

    .card > * {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      font-size: 1rem;
    }

    .card-title span.icon {
      font-size: 1.2rem;
    }

    .card-subtitle {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-bottom: 10px;
    }

    .tag {
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 0.75rem;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* FORMS / INPUTS / BUTTONS */

    label {
      display: block;
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    input[type="number"],
    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 8px 10px;
      margin-bottom: 8px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    textarea {
      border-radius: 12px;
      resize: vertical;
      min-height: 80px;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.45);
      background: #020617;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 7px 13px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      margin-right: 6px;
      margin-top: 4px;
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease,
        border-color 0.12s ease;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
    }

    button:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #0b1120;
      box-shadow: 0 7px 16px rgba(56, 189, 248, 0.4);
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-soft);
      border: 1px dashed rgba(148, 163, 184, 0.7);
    }

    .btn-small {
      padding: 5px 10px;
      font-size: 0.78rem;
    }

    .btn-shop {
      width: 100%;
      justify-content: space-between;
      margin-right: 0;
      margin-top: 6px;
    }

    .pill {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.7rem;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.85);
      color: var(--text-soft);
    }

    /* TIMER */

    .timer-value {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 0.18em;
      margin: 8px 0;
    }

    .timer-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .timer-status {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 6px;
      min-height: 18px;
    }

    .points-row {
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 0.9rem;
    }

    .points-row strong {
      font-size: 1.1rem;
    }

    .hint {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-top: 4px;
    }

    /* OWL PROFILE & PROGRESS */

    .owl-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 6px;
    }

    .owl-figure {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 6px 0 8px 0;
    }

    .owl-icon {
      width: 70px;
      height: 70px;
      border-radius: 24px;
      background: radial-gradient(circle at 30% 20%, #e0f2fe 0, #0369a1 40%, #020617 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.4rem;
      box-shadow: 0 12px 26px rgba(15, 23, 42, 0.95);
      border: 2px solid rgba(248, 250, 252, 0.7);
    }

    .owl-meta {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .owl-level {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .owl-xp {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .progress-shell {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(51, 65, 85, 0.8);
      overflow: hidden;
      margin-top: 5px;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      box-shadow: 0 0 12px rgba(56, 189, 248, 0.7);
      transition: width 0.25s ease;
    }

    .accessory-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .accessory-tag {
      font-size: 0.75rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* SHOP */

    .shop-list {
      margin-top: 4px;
    }

    .shop-item {
      padding: 6px 0;
      border-bottom: 1px dashed rgba(51, 65, 85, 0.9);
    }

    .shop-item:last-child {
      border-bottom: none;
    }

    .shop-label {
      font-size: 0.87rem;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .shop-meta-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-top: 4px;
    }

    .shop-cost {
      font-size: 0.8rem;
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .shop-status {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .shop-status.owned {
      color: var(--success);
    }

    .shop-status.equipped {
      color: var(--accent-2);
    }

    /* TIPS */

    .tips-list {
      list-style: none;
      font-size: 0.88rem;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .tips-list li {
      margin-bottom: 6px;
      padding-left: 16px;
      position: relative;
    }

    .tips-list li::before {
      content: "‚ú¶";
      position: absolute;
      left: 0;
      top: 0;
      font-size: 0.7rem;
      color: var(--accent-2);
      margin-top: 3px;
    }

    /* QUIZ */

    .quiz-builder {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 8px;
    }

    .quiz-preview {
      max-height: 110px;
      overflow-y: auto;
      padding: 6px 10px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px dashed rgba(51, 65, 85, 0.9);
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .quiz-preview p {
      margin-bottom: 4px;
    }

    .quiz-runner {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid rgba(31, 41, 55, 0.9);
    }

    .quiz-question {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .quiz-options {
      list-style: none;
      margin-bottom: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .quiz-result {
      font-size: 0.83rem;
      margin-top: 4px;
      min-height: 18px;
    }

    .quiz-result.correct {
      color: var(--success);
    }

    .quiz-result.wrong {
      color: var(--danger);
    }

    footer {
      text-align: center;
      margin-top: 22px;
      font-size: 0.78rem;
      color: var(--text-soft);
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo-row">
        <div class="logo-circle">
          <span>ü¶âüéì</span>
        </div>
        <div class="app-title">
          <h1>Study Buddy</h1>
          <p>Your math study partner ‚Äî focus, level up your owl, and earn rewards.</p>
        </div>
      </div>
      <div class="header-points">
        <span>‚≠ê</span>
        <span>Total Points: <strong id="headerPoints">0</strong></span>
        <span class="chip" id="headerLevelChip">Level 1 ¬∑ New Student</span>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT COLUMN: TIMER + TIPS -->
      <div class="column">
        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="icon">‚è±</span>
                <span>Study Timer</span>
              </div>
              <p class="card-subtitle">Pick a focus block, press start, and earn points when you finish.</p>
            </div>
            <span class="tag">10 points / 10 min</span>
          </div>

          <label for="minutesInput">Study minutes</label>
          <input type="number" id="minutesInput" min="1" max="180" value="25" />

          <div class="timer-value" id="timerDisplay">25:00</div>

          <div class="timer-controls">
            <button class="btn-primary" id="startTimerBtn">Start Session</button>
            <button class="btn-secondary btn-small" id="pauseTimerBtn">Pause</button>
            <button class="btn-ghost btn-small" id="resetTimerBtn">Reset</button>
          </div>

          <div class="timer-status" id="timerStatus">
            Choose a time and hit <strong>Start Session</strong>.
          </div>

          <div class="points-row">
            <div>
              Points this session (estimate): <strong id="sessionPointsPreview">20</strong>
            </div>
            <div class="pill">10 pts / 10 minutes (rounded)</div>
          </div>
          <p class="hint">
            Stay focused until the timer ends to collect points automatically.
          </p>
        </section>

        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="icon">üìê</span>
                <span>Math Study Help</span>
              </div>
              <p class="card-subtitle">Use these methods while your timer runs for better results.</p>
            </div>
            <span class="tag">Tips ‚Ä¢ Techniques</span>
          </div>

          <ul class="tips-list">
            <li><strong>Example ‚Üí Copy ‚Üí Create:</strong> Copy a solved example, then change the numbers and solve your own version.</li>
            <li><strong>Explain to your owl:</strong> Say out loud each step as if you are teaching your Study Buddy owl.</li>
            <li><strong>3 easy ‚Ä¢ 2 medium ‚Ä¢ 1 hard:</strong> In every block, mix difficulty so your brain stays awake.</li>
            <li><strong>Formula sprint:</strong> At the start, write all formulas you need from memory, then check them.</li>
            <li><strong>Why, not just what:</strong> For each step, ask ‚Äúwhy can I do this?‚Äù (e.g. ‚Äúbecause I added the same to both sides‚Äù).</li>
            <li><strong>Math diary:</strong> At the end of the session, write one thing that finally made sense today.</li>
          </ul>
        </section>
      </div>

      <!-- MIDDLE COLUMN: QUIZ MAKER -->
      <div class="column">
        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="icon">üìù</span>
                <span>Quiz Maker</span>
              </div>
              <p class="card-subtitle">Create your own math questions and test yourself.</p>
            </div>
            <span class="tag">Custom practice</span>
          </div>

          <div class="quiz-builder">
            <label for="quizQuestionInput">Question</label>
            <input
              type="text"
              id="quizQuestionInput"
              placeholder="e.g. What is 7 √ó 6?"
            />

            <label>Options</label>
            <input type="text" id="optA" placeholder="Option A" />
            <input type="text" id="optB" placeholder="Option B" />
            <input type="text" id="optC" placeholder="Option C" />
            <input type="text" id="optD" placeholder="Option D" />

            <label for="correctOptionSelect">Correct answer</label>
            <select id="correctOptionSelect">
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
              <option value="D">D</option>
            </select>

            <div>
              <button class="btn-primary btn-small" id="addQuestionBtn">
                ‚ûï Add Question
              </button>
              <button class="btn-ghost btn-small" id="clearQuestionsBtn">
                üßπ Clear All
              </button>
            </div>
          </div>

          <div class="quiz-preview" id="quizPreview">
            No questions yet. Add one above to start your quiz bank.
          </div>

          <div class="quiz-runner" id="quizRunner" style="display:none;">
            <div class="quiz-question" id="currentQuizQuestion"></div>
            <ul class="quiz-options" id="quizOptionsList"></ul>
            <button class="btn-secondary btn-small" id="nextQuestionBtn">
              Next Question
            </button>
            <div class="quiz-result" id="quizResult"></div>
          </div>

          <div style="margin-top:8px;">
            <button class="btn-primary btn-small" id="startQuizBtn">
              ‚ñ∂ Start Quiz
            </button>
          </div>

          <p class="hint" style="margin-top:6px;">
            Idea: turn your homework problems into quiz questions and see what you remember tomorrow.
          </p>
        </section>
      </div>

      <!-- RIGHT COLUMN: OWL + SHOP -->
      <div class="column">
        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="icon">ü¶â</span>
                <span>Your Study Buddy</span>
              </div>
              <p class="card-subtitle">Level up your owl and equip cool accessories.</p>
            </div>
            <span class="tag" id="pointsTag">Points: 0</span>
          </div>

          <div class="owl-header-row">
            <div>
              <div class="owl-figure">
                <div class="owl-icon" id="owlIcon">ü¶âüéì</div>
                <div class="owl-meta">
                  <div class="owl-level" id="owlLevelText">Level 1 ¬∑ New Student</div>
                  <div class="owl-xp" id="owlXpText">0 / 50 points to next level</div>
                </div>
              </div>
            </div>
          </div>

          <div class="progress-shell">
            <div class="progress-bar" id="levelProgress"></div>
          </div>

          <div class="accessory-tags" id="equippedAccessories">
            <!-- Filled by JS -->
          </div>

          <p class="hint">
            Earn points with the timer, then visit the shop to buy accessories for your owl.
          </p>
        </section>

        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="icon">üõí</span>
                <span>Owl Accessory Shop</span>
              </div>
              <p class="card-subtitle">Spend your points on upgrades and style.</p>
            </div>
            <span class="tag">Cosmetics only ¬∑ Keep your points safe</span>
          </div>

          <div class="shop-list" id="shopList">
            <!-- Shop items from JS -->
          </div>

          <p class="hint">
            Tip: Save up for a big item, or collect lots of smaller ones and swap styles whenever you like.
          </p>
        </section>
      </div>
    </div>

    <footer>
      Study Buddy ¬∑ Practice a little every day ¬∑ Your owl believes in you ü¶âüéì
    </footer>
  </div>

  <script>
    /* ----------------------
       GLOBAL STATE
    ---------------------- */
    let totalPoints = 0;
    let timerInterval = null;
    let remainingSeconds = 0;
    let isRunning = false;
    let currentSessionMinutes = 25;

    const accessories = [
      {
        id: "glasses",
        name: "Smart Glasses",
        emoji: "üï∂Ô∏è",
        cost: 40,
        owned: false,
        equipped: false,
        description: "Your owl looks extra clever for algebra."
      },
      {
        id: "cape",
        name: "Superhero Cape",
        emoji: "ü¶∏‚Äç‚ôÇÔ∏è",
        cost: 70,
        owned: false,
        equipped: false,
        description: "Perfect for saving your test scores."
      },
      {
        id: "sparkles",
        name: "Sparkle Aura",
        emoji: "‚ú®",
        cost: 90,
        owned: false,
        equipped: false,
        description: "Because math magic is real."
      },
      {
        id: "star",
        name: "Gold Star Badge",
        emoji: "üåü",
        cost: 120,
        owned: false,
        equipped: false,
        description: "Shows you crush problem sets."
      }
    ];

    const quizQuestions = [];
    let quizIndex = 0;
    let quizScore = 0;
    let quizActive = false;

    /* ----------------------
       DOM HELPERS
    ---------------------- */
    const $ = (id) => document.getElementById(id);

    const minutesInput = $("minutesInput");
    const timerDisplay = $("timerDisplay");
    const timerStatus = $("timerStatus");
    const startTimerBtn = $("startTimerBtn");
    const pauseTimerBtn = $("pauseTimerBtn");
    const resetTimerBtn = $("resetTimerBtn");
    const sessionPointsPreview = $("sessionPointsPreview");

    const headerPoints = $("headerPoints");
    const headerLevelChip = $("headerLevelChip");
    const pointsTag = $("pointsTag");
    const owlIcon = $("owlIcon");
    const owlLevelText = $("owlLevelText");
    const owlXpText = $("owlXpText");
    const levelProgress = $("levelProgress");
    const equippedAccessories = $("equippedAccessories");
    const shopList = $("shopList");

    const quizQuestionInput = $("quizQuestionInput");
    const optA = $("optA");
    const optB = $("optB");
    const optC = $("optC");
    const optD = $("optD");
    const correctOptionSelect = $("correctOptionSelect");
    const addQuestionBtn = $("addQuestionBtn");
    const clearQuestionsBtn = $("clearQuestionsBtn");
    const quizPreview = $("quizPreview");
    const quizRunner = $("quizRunner");
    const currentQuizQuestion = $("currentQuizQuestion");
    const quizOptionsList = $("quizOptionsList");
    const quizResult = $("quizResult");
    const startQuizBtn = $("startQuizBtn");
    const nextQuestionBtn = $("nextQuestionBtn");

    /* ----------------------
       TIMER LOGIC
    ---------------------- */
    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
    }

    function updateTimerDisplay() {
      timerDisplay.textContent = formatTime(remainingSeconds);
    }

    function calculateSessionPointsEstimate() {
      const minutes = parseInt(minutesInput.value, 10) || 0;
      const blocksOfTen = Math.round(minutes / 10);
      const estimate = blocksOfTen * 10;
      sessionPointsPreview.textContent = estimate;
    }

    function startTimer() {
      if (isRunning) return;

      const minutes = parseInt(minutesInput.value, 10) || 0;
      if (minutes <= 0) {
        timerStatus.textContent = "Please choose at least 1 minute.";
        return;
      }

      currentSessionMinutes = minutes;
      remainingSeconds = minutes * 60;
      updateTimerDisplay();
      timerStatus.textContent = "Studying... stay focused! üìö";
      isRunning = true;

      startTimerBtn.textContent = "Running...";
      startTimerBtn.disabled = true;
      pauseTimerBtn.disabled = false;

      timerInterval = setInterval(() => {
        remainingSeconds--;
        updateTimerDisplay();
        if (remainingSeconds <= 0) {
          clearInterval(timerInterval);
          isRunning = false;
          startTimerBtn.textContent = "Start Session";
          startTimerBtn.disabled = false;
          pauseTimerBtn.disabled = true;
          remainingSeconds = 0;
          updateTimerDisplay();
          const earned = awardPointsForSession(currentSessionMinutes);
          timerStatus.textContent =
            "Nice work! Session complete. You earned +" + earned + " points. üéâ";
        }
      }, 1000);
    }

    function pauseTimer() {
      if (!isRunning) return;
      clearInterval(timerInterval);
      isRunning = false;
      startTimerBtn.textContent = "Resume";
      startTimerBtn.disabled = false;
      pauseTimerBtn.disabled = true;
      timerStatus.textContent = "Paused. Take a short break, then resume.";
    }

    function resetTimer() {
      clearInterval(timerInterval);
      isRunning = false;
      const minutes = parseInt(minutesInput.value, 10) || 25;
      remainingSeconds = minutes * 60;
      updateTimerDisplay();
      startTimerBtn.textContent = "Start Session";
      startTimerBtn.disabled = false;
      pauseTimerBtn.disabled = false;
      timerStatus.textContent = "Timer reset. Ready when you are.";
      calculateSessionPointsEstimate();
    }

    function awardPointsForSession(minutesStudied) {
      const blocksOfTen = Math.round(minutesStudied / 10);
      const earned = blocksOfTen * 10;
      if (earned > 0) {
        totalPoints += earned;
        updatePointsUI();
      }
      return earned;
    }

    minutesInput.addEventListener("input", () => {
      calculateSessionPointsEstimate();
      const minutes = parseInt(minutesInput.value, 10) || 0;
      remainingSeconds = minutes * 60;
      updateTimerDisplay();
    });

    startTimerBtn.addEventListener("click", startTimer);
    pauseTimerBtn.addEventListener("click", pauseTimer);
    resetTimerBtn.addEventListener("click", resetTimer);

    /* ----------------------
       POINTS + LEVELS + OWL
    ---------------------- */
    function getLevelInfo(points) {
      if (points >= 250) {
        return {
          level: 4,
          name: "Legendary Math Sage",
          floor: 250,
          cap: 350,
          nextLabel: "Max level (for now!)"
        };
      } else if (points >= 150) {
        return {
          level: 3,
          name: "Algebra Master",
          floor: 150,
          cap: 250,
          nextLabel: `${250 - points} points to Level 4`
        };
      } else if (points >= 50) {
        return {
          level: 2,
          name: "Geometry Pro",
          floor: 50,
          cap: 150,
          nextLabel: `${150 - points} points to Level 3`
        };
      } else {
        return {
          level: 1,
          name: "New Student",
          floor: 0,
          cap: 50,
          nextLabel: `${50 - points} points to Level 2`
        };
      }
    }

    function updateOwlIcon() {
      const baseOwl = "ü¶âüéì";
      const equipped = accessories.filter((a) => a.equipped);
      const extra = equipped.map((a) => a.emoji).join(" ");
      owlIcon.textContent = extra ? baseOwl + " " + extra : baseOwl;
    }

    function updateEquippedAccessoryTags() {
      equippedAccessories.innerHTML = "";
      const equipped = accessories.filter((a) => a.equipped);
      if (equipped.length === 0) {
        const span = document.createElement("span");
        span.className = "accessory-tag";
        span.textContent = "No accessories equipped yet.";
        equippedAccessories.appendChild(span);
        return;
      }
      equipped.forEach((a) => {
        const span = document.createElement("span");
        span.className = "accessory-tag";
        span.innerHTML = `${a.emoji} ${a.name}`;
        equippedAccessories.appendChild(span);
      });
    }

    function updatePointsUI() {
      headerPoints.textContent = totalPoints;
      pointsTag.textContent = "Points: " + totalPoints;

      const levelInfo = getLevelInfo(totalPoints);
      headerLevelChip.textContent = `Level ${levelInfo.level} ¬∑ ${levelInfo.name}`;
      owlLevelText.textContent = `Level ${levelInfo.level} ¬∑ ${levelInfo.name}`;
      owlXpText.textContent = `${totalPoints - levelInfo.floor} / ${
        levelInfo.cap - levelInfo.floor
      } points to next level (${levelInfo.nextLabel})`;

      const range = levelInfo.cap - levelInfo.floor;
      const progress = range > 0 ? ((totalPoints - levelInfo.floor) / range) * 100 : 100;
      levelProgress.style.width = Math.min(100, Math.max(0, progress)) + "%";

      renderShop();
      updateOwlIcon();
      updateEquippedAccessoryTags();
    }

    /* ----------------------
       SHOP LOGIC
    ---------------------- */
    function toggleAccessory(id) {
      const item = accessories.find((a) => a.id === id);
      if (!item) return;

      if (!item.owned) {
        // Try to buy
        if (totalPoints < item.cost) {
          alert("Not enough points for this accessory yet. Keep studying!");
          return;
        }
        if (!confirm(`Buy "${item.name}" for ${item.cost} points?`)) {
          return;
        }
        totalPoints -= item.cost;
        item.owned = true;
        item.equipped = true;
      } else {
        // Already owned -> toggle equipped
        item.equipped = !item.equipped;
      }

      updatePointsUI();
    }

    function renderShop() {
      shopList.innerHTML = "";
      accessories.forEach((item) => {
        const div = document.createElement("div");
        div.className = "shop-item";

        const labelDiv = document.createElement("div");
        labelDiv.className = "shop-label";
        labelDiv.innerHTML = `<span>${item.emoji} ${item.name}</span><span class="hint">${item.description}</span>`;

        const metaRow = document.createElement("div");
        metaRow.className = "shop-meta-row";

        const costSpan = document.createElement("span");
        costSpan.className = "shop-cost";
        costSpan.innerHTML = `‚≠ê ${item.cost} pts`;

        const statusSpan = document.createElement("span");
        statusSpan.className = "shop-status";
        if (item.equipped) {
          statusSpan.classList.add("equipped");
          statusSpan.textContent = "Equipped";
        } else if (item.owned) {
          statusSpan.classList.add("owned");
          statusSpan.textContent = "Owned";
        } else {
          statusSpan.textContent = "Locked";
        }

        const btn = document.createElement("button");
        btn.className = "btn-secondary btn-small btn-shop";
        if (!item.owned) {
          btn.innerHTML = `Buy & Equip <span>‚ûú</span>`;
        } else {
          btn.innerHTML = item.equipped ? `Unequip` : `Equip`;
        }
        btn.addEventListener("click", () => toggleAccessory(item.id));

        metaRow.appendChild(costSpan);
        metaRow.appendChild(statusSpan);

        div.appendChild(labelDiv);
        div.appendChild(metaRow);
        div.appendChild(btn);

        shopList.appendChild(div);
      });
    }

    /* ----------------------
       QUIZ MAKER LOGIC
    ---------------------- */
    function refreshQuizPreview() {
      if (quizQuestions.length === 0) {
        quizPreview.textContent =
          "No questions yet. Add one above to start your quiz bank.";
        quizRunner.style.display = "none";
        return;
      }

      quizPreview.innerHTML = "";
      quizQuestions.forEach((q, index) => {
        const p = document.createElement("p");
        p.textContent = `${index + 1}. ${q.question} (Correct: ${q.correct})`;
        quizPreview.appendChild(p);
      });
    }

    function addQuestion() {
      const question = quizQuestionInput.value.trim();
      const a = optA.value.trim();
      const b = optB.value.trim();
      const c = optC.value.trim();
      const d = optD.value.trim();
      const correct = correctOptionSelect.value;

      if (!question || !a || !b || !c || !d) {
        alert("Please fill in the question and all four options.");
        return;
      }

      quizQuestions.push({
        question,
        options: { A: a, B: b, C: c, D: d },
        correct
      });

      quizQuestionInput.value = "";
      optA.value = "";
      optB.value = "";
      optC.value = "";
      optD.value = "";
      correctOptionSelect.value = "A";

      refreshQuizPreview();
    }

    function clearQuestions() {
      if (!confirm("Clear all quiz questions?")) return;
      quizQuestions.length = 0;
      quizRunner.style.display = "none";
      quizResult.textContent = "";
      quizActive = false;
      refreshQuizPreview();
    }

    function startQuiz() {
      if (quizQuestions.length === 0) {
        alert("Add at least one question before starting the quiz.");
        return;
      }
      quizRunner.style.display = "block";
      quizIndex = 0;
      quizScore = 0;
      quizActive = true;
      quizResult.textContent = "";
      showQuizQuestion();
    }

    function showQuizQuestion() {
      const q = quizQuestions[quizIndex];
      currentQuizQuestion.textContent = `${quizIndex + 1}. ${q.question}`;
      quizOptionsList.innerHTML = "";

      ["A", "B", "C", "D"].forEach((letter) => {
        const li = document.createElement("li");
        const btn = document.createElement("button");
        btn.className = "btn-secondary btn-small";
        btn.textContent = `${letter}: ${q.options[letter]}`;
        btn.addEventListener("click", () => selectAnswer(letter));
        li.appendChild(btn);
        quizOptionsList.appendChild(li);
      });

      quizResult.textContent = "";
      quizResult.className = "quiz-result";
    }

    function selectAnswer(choice) {
      const q = quizQuestions[quizIndex];
      if (choice === q.correct) {
        quizResult.textContent = "‚úÖ Correct! Nice job.";
        quizResult.className = "quiz-result correct";
        quizScore++;
      } else {
        quizResult.textContent = `‚ùå Not quite. Correct answer: ${q.correct}`;
        quizResult.className = "quiz-result wrong";
      }
    }

    function nextQuestion() {
      if (!quizActive) return;
      quizIndex++;
      if (quizIndex >= quizQuestions.length) {
        quizActive = false;
        quizOptionsList.innerHTML = "";
        currentQuizQuestion.textContent = "Quiz finished!";
        quizResult.className = "quiz-result correct";
        quizResult.textContent = `You scored ${quizScore} out of ${quizQuestions.length}.`;
      } else {
        showQuizQuestion();
      }
    }

    addQuestionBtn.addEventListener("click", addQuestion);
    clearQuestionsBtn.addEventListener("click", clearQuestions);
    startQuizBtn.addEventListener("click", startQuiz);
    nextQuestionBtn.addEventListener("click", nextQuestion);

    /* ----------------------
       INITIAL SETUP
    ---------------------- */
    function init() {
      calculateSessionPointsEstimate();
      const minutes = parseInt(minutesInput.value, 10) || 25;
      remainingSeconds = minutes * 60;
      updateTimerDisplay();
      renderShop();
      updateEquippedAccessoryTags();
    }

    init();
  </script>
</body>
</html>
