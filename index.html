<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Study Buddy</title>
  <style>
    :root {
      --bg: #f7f1e7;
      --bg-soft: #fdfaf5;
      --card-bg: #ffffff;
      --accent: #c9885b;
      --accent-soft: #f2dfcf;
      --accent-2: #8a5a3b;
      --border-subtle: #e1d4c5;
      --text-main: #3f342a;
      --text-soft: #7d6a57;
      --danger: #c4554a;
      --success: #4c8f5b;
      --radius-lg: 18px;
      --shadow-soft: 0 10px 26px rgba(105, 78, 49, 0.15);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #fdf7ee 0, #f7f1e7 50%, #f0e3d4 100%);
      color: var(--text-main);
      padding: 24px;
    }

    .app {
      max-width: 1100px;
      margin: 0 auto;
    }

    /* HEADER */

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 16px;
      padding: 16px 20px;
      border-radius: 18px;
      background: linear-gradient(135deg, #f8ede0, #f3dfcd);
      border: 1px solid #e4cfb9;
      box-shadow: 0 10px 24px rgba(121, 85, 52, 0.25);
    }

    .logo-row {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-circle {
      width: 54px;
      height: 54px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fffaf4 0, #e2c09a 45%, #b47c4b 80%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 22px rgba(121, 85, 52, 0.4);
      border: 2px solid #fff7ef;
    }

    .logo-circle span {
      font-size: 2rem;
    }

    .app-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .app-title h1 {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      color: #4a3725;
    }

    .app-title p {
      font-size: 0.9rem;
      color: #8a6f56;
    }

    .header-points {
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid #e4cfb9;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
      color: #5f4632;
    }

    .header-points span:first-child {
      font-size: 1.1rem;
    }

    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #f3e2cf;
      border: 1px solid #e1cfbc;
      color: #7b5e43;
    }

    /* TABS / SLIDES */

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      background: #f2e4d4;
      padding: 6px;
      border-radius: 999px;
      border: 1px solid #e2cdb9;
    }

    .tab {
      flex: 1;
      border-radius: 999px;
      border: none;
      background: transparent;
      padding: 8px 10px;
      font-size: 0.85rem;
      font-weight: 600;
      color: #8a6f56;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.08s ease;
    }

    .tab span.icon {
      font-size: 1rem;
    }

    .tab.active {
      background: #fffaf4;
      color: #5b3d26;
      box-shadow: 0 6px 14px rgba(156, 112, 70, 0.3);
      transform: translateY(-1px);
    }

    .slides {
      position: relative;
    }

    .slide {
      display: none;
      animation: fadeIn 0.18s ease-out;
    }

    .slide.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* CARDS */

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 18px 20px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      margin-bottom: 14px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      font-size: 1rem;
      color: #5c4331;
    }

    .card-title span.icon {
      font-size: 1.2rem;
    }

    .card-subtitle {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    .tag {
      padding: 3px 9px;
      border-radius: 999px;
      background: #f8ecde;
      border: 1px solid #e2cdb9;
      font-size: 0.75rem;
      color: #7c6048;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    label {
      display: block;
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    input[type="number"],
    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 8px 10px;
      margin-bottom: 8px;
      border-radius: 999px;
      border: 1px solid #ddc7b3;
      background: #fdf8f1;
      color: var(--text-main);
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    textarea {
      border-radius: 12px;
      resize: vertical;
      min-height: 80px;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(201, 136, 91, 0.4);
      background: #fffaf3;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 7px 13px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      margin-right: 6px;
      margin-top: 4px;
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease,
        border-color 0.12s ease;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
    }

    button:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #d69b6b, #b4774c);
      color: #fff8ef;
      box-shadow: 0 7px 16px rgba(158, 106, 63, 0.5);
    }

    .btn-secondary {
      background: #f5e5d4;
      color: #5b412d;
      border: 1px solid #ddc5ae;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-soft);
      border: 1px dashed #d5c3b1;
    }

    .btn-small {
      padding: 5px 10px;
      font-size: 0.78rem;
    }

    .pill {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      border: 1px solid #e2cdb9;
      background: #fbf2e7;
      color: #7c6048;
    }

    /* TIMER */

    .timer-value {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 0.18em;
      margin: 8px 0;
      color: #5c4331;
    }

    .timer-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .timer-status {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 6px;
      min-height: 18px;
    }

    .points-row {
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 0.9rem;
    }

    .points-row strong {
      font-size: 1.1rem;
      color: #5c4331;
    }

    .hint {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 4px;
    }

    /* OWL PROFILE & SHOP */

    .owl-figure {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 6px 0 10px 0;
    }

    .owl-icon {
      width: 72px;
      height: 72px;
      border-radius: 24px;
      background: radial-gradient(circle at 30% 20%, #fffaf6 0, #e3c199 45%, #bf8450 85%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      box-shadow: 0 12px 26px rgba(121, 85, 52, 0.45);
      border: 2px solid #fff5ea;
    }

    .owl-meta {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .owl-level {
      font-size: 0.95rem;
      font-weight: 600;
      color: #5c4331;
    }

    .owl-xp {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .progress-shell {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #f5e6d4;
      border: 1px solid #e0ccb8;
      overflow: hidden;
      margin-top: 5px;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #d69b6b, #b4774c);
      box-shadow: 0 0 12px rgba(187, 123, 68, 0.6);
      transition: width 0.25s ease;
    }

    .accessory-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .accessory-tag {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: #f7ebdd;
      border: 1px solid #e1cebb;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: #6a5038;
    }

    .shop-list {
      margin-top: 4px;
    }

    .shop-item {
      padding: 7px 0;
      border-bottom: 1px dashed #e0ccb8;
    }

    .shop-item:last-child {
      border-bottom: none;
    }

    .shop-label {
      font-size: 0.88rem;
      display: flex;
      flex-direction: column;
      gap: 2px;
      color: #5b432f;
    }

    .shop-meta-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-top: 4px;
    }

    .shop-cost {
      font-size: 0.8rem;
      color: var(--accent-2);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .shop-status {
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .shop-status.owned {
      color: var(--success);
    }

    .shop-status.equipped {
      color: var(--accent-2);
      font-weight: 600;
    }

    .btn-shop {
      width: 100%;
      justify-content: space-between;
      margin-right: 0;
      margin-top: 6px;
    }

    /* TIPS */

    .tips-list {
      list-style: none;
      font-size: 0.9rem;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .tips-list li {
      margin-bottom: 8px;
      padding-left: 18px;
      position: relative;
    }

    .tips-list li::before {
      content: "‚ú¶";
      position: absolute;
      left: 0;
      top: 0;
      font-size: 0.7rem;
      color: var(--accent-2);
      margin-top: 3px;
    }

    /* QUIZ */

    .quiz-builder {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 8px;
    }

    .quiz-preview {
      max-height: 120px;
      overflow-y: auto;
      padding: 6px 10px;
      border-radius: 12px;
      background: #f9f1e7;
      border: 1px dashed #e0ccb8;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .quiz-preview p {
      margin-bottom: 4px;
    }

    .quiz-runner {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid #ead6c3;
    }

    .quiz-question {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 6px;
      color: #5c4331;
    }

    .quiz-options {
      list-style: none;
      margin-bottom: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .quiz-result {
      font-size: 0.83rem;
      margin-top: 4px;
      min-height: 18px;
    }

    .quiz-result.correct {
      color: var(--success);
    }

    .quiz-result.wrong {
      color: var(--danger);
    }

    footer {
      text-align: center;
      margin-top: 18px;
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    @media (max-width: 720px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        border-radius: 18px;
      }

      .tabs {
        flex-wrap: wrap;
      }

      .tab {
        flex: 1 1 calc(50% - 8px);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- HEADER -->
    <header>
      <div class="logo-row">
        <div class="logo-circle">
          <span>ü¶âüéì</span>
        </div>
        <div class="app-title">
          <h1>Study Buddy</h1>
          <p>Your cozy math study app ‚Äì focus, earn points, level up your owl.</p>
        </div>
      </div>
      <div class="header-points">
        <span>‚≠ê</span>
        <span>Total Points: <strong id="headerPoints">0</strong></span>
        <span class="chip" id="headerLevelChip">Level 1 ¬∑ New Student</span>
      </div>
    </header>

    <!-- TABS -->
    <nav class="tabs">
      <button class="tab active" data-target="slide-timer">
        <span class="icon">‚è±</span><span>Timer</span>
      </button>
      <button class="tab" data-target="slide-owl">
        <span class="icon">ü¶â</span><span>Owl & Shop</span>
      </button>
      <button class="tab" data-target="slide-quiz">
        <span class="icon">üìù</span><span>Quiz Maker</span>
      </button>
      <button class="tab" data-target="slide-help">
        <span class="icon">üìê</span><span>Study Help</span>
      </button>
    </nav>

    <!-- SLIDES -->
    <main class="slides">
      <!-- SLIDE 1: TIMER -->
      <section id="slide-timer" class="slide active">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="icon">‚è±</span>
                <span>Study Timer</span>
              </div>
              <p class="card-subtitle">Set a focus block and earn points when you finish.</p>
            </div>
            <span class="tag">10 pts / 10 min</span>
          </div>

          <label for="minutesInput">Study minutes</label>
          <input type="number" id="minutesInput" min="1" max="180" value="25" />

          <div class="timer-value" id="timerDisplay">25:00</div>

          <div class="timer-controls">
            <button class="btn-primary" id="startTimerBtn">Start Session</button>
            <button class="btn-secondary btn-small" id="pauseTimerBtn">Pause</button>
            <button class="btn-ghost btn-small" id="resetTimerBtn">Reset</button>
          </div>

          <div class="timer-status" id="timerStatus">
            Choose a time and tap <strong>Start Session</strong>.
          </div>

          <div class="points-row">
            <div>
              Points this session (estimate): <strong id="sessionPointsPreview">20</strong>
            </div>
            <div class="pill">Points are added when the timer ends.</div>
          </div>
          <p class="hint">
            Tip: put your phone away until the timer finishes, then reward yourself with points and owl upgrades.
          </p>
        </div>
      </section>

      <!-- SLIDE 2: OWL & SHOP -->
      <section id="slide-owl" class="slide">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="icon">ü¶â</span>
                <span>Your Study Buddy Owl</span>
              </div>
              <p class="card-subtitle">Level up and equip accessories using your points.</p>
            </div>
            <span class="tag" id="pointsTag">Points: 0</span>
          </div>

          <div class="owl-figure">
            <div class="owl-icon" id="owlIcon">ü¶âüéì</div>
            <div class="owl-meta">
              <div class="owl-level" id="owlLevelText">Level 1 ¬∑ New Student</div>
              <div class="owl-xp" id="owlXpText">0 / 50 points to next level</div>
            </div>
          </div>

          <div class="progress-shell">
            <div class="progress-bar" id="levelProgress"></div>
          </div>

          <div class="accessory-tags" id="equippedAccessories">
            <!-- Filled by JS -->
          </div>

          <p class="hint">
            Keep studying with the timer to earn points, then visit the shop to buy glasses, capes, sparkles, and more.
          </p>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="icon">üõí</span>
                <span>Owl Accessory Shop</span>
              </div>
              <p class="card-subtitle">Spend your points on cozy upgrades and style.</p>
            </div>
            <span class="tag">Cosmetics only ¬∑ No pressure</span>
          </div>

          <div class="shop-list" id="shopList">
            <!-- Shop items from JS -->
          </div>

          <p class="hint">
            Idea: set a goal like ‚ÄúWhen I reach 100 points, I‚Äôll buy the Sparkle Aura‚Äù.
          </p>
        </div>
      </section>

      <!-- SLIDE 3: QUIZ MAKER -->
      <section id="slide-quiz" class="slide">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="icon">üìù</span>
                <span>Quiz Maker</span>
              </div>
              <p class="card-subtitle">Turn your math problems into a custom quiz.</p>
            </div>
            <span class="tag">Self-test</span>
          </div>

          <div class="quiz-builder">
            <label for="quizQuestionInput">Question</label>
            <input
              type="text"
              id="quizQuestionInput"
              placeholder="e.g. What is 7 √ó 6?"
            />

            <label>Options</label>
            <input type="text" id="optA" placeholder="Option A" />
            <input type="text" id="optB" placeholder="Option B" />
            <input type="text" id="optC" placeholder="Option C" />
            <input type="text" id="optD" placeholder="Option D" />

            <label for="correctOptionSelect">Correct answer</label>
            <select id="correctOptionSelect">
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
              <option value="D">D</option>
            </select>

            <div>
              <button class="btn-primary btn-small" id="addQuestionBtn">
                ‚ûï Add Question
              </button>
              <button class="btn-ghost btn-small" id="clearQuestionsBtn">
                üßπ Clear All
              </button>
            </div>
          </div>

          <div class="quiz-preview" id="quizPreview">
            No questions yet. Add one above to start your quiz bank.
          </div>

          <div class="quiz-runner" id="quizRunner" style="display:none;">
            <div class="quiz-question" id="currentQuizQuestion"></div>
            <ul class="quiz-options" id="quizOptionsList"></ul>
            <button class="btn-secondary btn-small" id="nextQuestionBtn">
              Next Question
            </button>
            <div class="quiz-result" id="quizResult"></div>
          </div>

          <div style="margin-top:8px;">
            <button class="btn-primary btn-small" id="startQuizBtn">
              ‚ñ∂ Start Quiz
            </button>
          </div>

          <p class="hint" style="margin-top:6px;">
            Use your class notes: write today‚Äôs problems as quiz questions and try again tomorrow.
          </p>
        </div>
      </section>

      <!-- SLIDE 4: STUDY HELP -->
      <section id="slide-help" class="slide">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <span class="icon">üìê</span>
                <span>Math Study Help Methods</span>
              </div>
              <p class="card-subtitle">Use these while the timer runs to get more from each session.</p>
            </div>
            <span class="tag">Ideas & routines</span>
          </div>

          <ul class="tips-list">
            <li><strong>Example ‚Üí Practice ‚Üí Check:</strong> Copy one example from the book, hide it, and do a similar problem yourself. Then compare step by step.</li>
            <li><strong>Explain to your owl:</strong> For each step, say out loud what you‚Äôre doing and why. Imagine your Study Buddy owl is your student.</li>
            <li><strong>3‚Äì2‚Äì1 mix:</strong> Do 3 easy problems, 2 medium, and 1 hard in every timer session so you feel progress and still stretch yourself.</li>
            <li><strong>Error detective:</strong> When you miss a question, circle where it went wrong and write one sentence: ‚ÄúNext time I‚Äôll remember to‚Ä¶‚Äù.</li>
            <li><strong>Formula warm-up:</strong> In the first 3 minutes, write all formulas you need from memory (area, volume, equations). Then check and fix them.</li>
            <li><strong>Connect topics:</strong> After finishing, ask: ‚ÄúHow is this like something I learned before?‚Äù (fractions vs decimals, area vs perimeter, etc.).</li>
            <li><strong>End-of-session note:</strong> On a small paper or notebook, write one thing that finally made sense today. That‚Äôs your tiny math win.</li>
          </ul>
        </div>
      </section>
    </main>

    <footer>
      Study Buddy ¬∑ Cozy math practice ¬∑ Your owl believes in you ü¶âüéì
    </footer>
  </div>

  <script>
    /* ---------- SIMPLE HELPERS ---------- */
    const $ = (id) => document.getElementById(id);

    /* ---------- TABS / SLIDES ---------- */
    const tabs = document.querySelectorAll(".tab");
    const slides = document.querySelectorAll(".slide");

    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        const targetId = tab.dataset.target;

        tabs.forEach((t) => t.classList.remove("active"));
        slides.forEach((s) => s.classList.remove("active"));

        tab.classList.add("active");
        document.getElementById(targetId).classList.add("active");
      });
    });

    /* ---------- GLOBAL STATE ---------- */
    let totalPoints = 0;
    let timerInterval = null;
    let remainingSeconds = 0;
    let isRunning = false;
    let currentSessionMinutes = 25;

    const accessories = [
      {
        id: "glasses",
        name: "Smart Glasses",
        emoji: "üï∂Ô∏è",
        cost: 40,
        owned: false,
        equipped: false,
        description: "Your owl looks extra clever for algebra."
      },
      {
        id: "cape",
        name: "Superhero Cape",
        emoji: "ü¶∏‚Äç‚ôÇÔ∏è",
        cost: 70,
        owned: false,
        equipped: false,
        description: "Perfect for saving your test scores."
      },
      {
        id: "sparkles",
        name: "Sparkle Aura",
        emoji: "‚ú®",
        cost: 90,
        owned: false,
        equipped: false,
        description: "A magical glow for focus mode."
      },
      {
        id: "star",
        name: "Gold Star Badge",
        emoji: "üåü",
        cost: 120,
        owned: false,
        equipped: false,
        description: "Shows you crush problem sets."
      }
    ];

    const quizQuestions = [];
    let quizIndex = 0;
    let quizScore = 0;
    let quizActive = false;

    /* ---------- DOM ELEMENTS ---------- */
    const minutesInput = $("minutesInput");
    const timerDisplay = $("timerDisplay");
    const timerStatus = $("timerStatus");
    const startTimerBtn = $("startTimerBtn");
    const pauseTimerBtn = $("pauseTimerBtn");
    const resetTimerBtn = $("resetTimerBtn");
    const sessionPointsPreview = $("sessionPointsPreview");

    const headerPoints = $("headerPoints");
    const headerLevelChip = $("headerLevelChip");
    const pointsTag = $("pointsTag");
    const owlIcon = $("owlIcon");
    const owlLevelText = $("owlLevelText");
    const owlXpText = $("owlXpText");
    const levelProgress = $("levelProgress");
    const equippedAccessories = $("equippedAccessories");
    const shopList = $("shopList");

    const quizQuestionInput = $("quizQuestionInput");
    const optA = $("optA");
    const optB = $("optB");
    const optC = $("optC");
    const optD = $("optD");
    const correctOptionSelect = $("correctOptionSelect");
    const addQuestionBtn = $("addQuestionBtn");
    const clearQuestionsBtn = $("clearQuestionsBtn");
    const quizPreview = $("quizPreview");
    const quizRunner = $("quizRunner");
    const currentQuizQuestion = $("currentQuizQuestion");
    const quizOptionsList = $("quizOptionsList");
    const quizResult = $("quizResult");
    const startQuizBtn = $("startQuizBtn");
    const nextQuestionBtn = $("nextQuestionBtn");

    /* ---------- TIMER LOGIC ---------- */
    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
    }

    function updateTimerDisplay() {
      timerDisplay.textContent = formatTime(remainingSeconds);
    }

    function calculateSessionPointsEstimate() {
      const minutes = parseInt(minutesInput.value, 10) || 0;
      const blocksOfTen = Math.round(minutes / 10);
      const estimate = blocksOfTen * 10;
      sessionPointsPreview.textContent = estimate;
    }

    function startTimer() {
      if (isRunning) return;

      const minutes = parseInt(minutesInput.value, 10) || 0;
      if (minutes <= 0) {
        timerStatus.textContent = "Please choose at least 1 minute.";
        return;
      }

      currentSessionMinutes = minutes;
      remainingSeconds = minutes * 60;
      updateTimerDisplay();
      timerStatus.textContent = "Studying... stay focused!";
      isRunning = true;

      startTimerBtn.textContent = "Running...";
      startTimerBtn.disabled = true;
      pauseTimerBtn.disabled = false;

      timerInterval = setInterval(() => {
        remainingSeconds--;
        updateTimerDisplay();
        if (remainingSeconds <= 0) {
          clearInterval(timerInterval);
          isRunning = false;
          startTimerBtn.textContent = "Start Session";
          startTimerBtn.disabled = false;
          pauseTimerBtn.disabled = true;
          remainingSeconds = 0;
          updateTimerDisplay();
          const earned = awardPointsForSession(currentSessionMinutes);
          timerStatus.textContent =
            "Nice work! Session complete. You earned +" + earned + " points. üéâ";
        }
      }, 1000);
    }

    function pauseTimer() {
      if (!isRunning) return;
      clearInterval(timerInterval);
      isRunning = false;
      startTimerBtn.textContent = "Resume";
      startTimerBtn.disabled = false;
      pauseTimerBtn.disabled = true;
      timerStatus.textContent = "Paused. Take a breath and then resume.";
    }

    function resetTimer() {
      clearInterval(timerInterval);
      isRunning = false;
      const minutes = parseInt(minutesInput.value, 10) || 25;
      remainingSeconds = minutes * 60;
      updateTimerDisplay();
      startTimerBtn.textContent = "Start Session";
      startTimerBtn.disabled = false;
      pauseTimerBtn.disabled = false;
      timerStatus.textContent = "Timer reset. Ready when you are.";
      calculateSessionPointsEstimate();
    }

    function awardPointsForSession(minutesStudied) {
      const blocksOfTen = Math.round(minutesStudied / 10);
      const earned = blocksOfTen * 10;
      if (earned > 0) {
        totalPoints += earned;
        updatePointsUI();
      }
      return earned;
    }

    minutesInput.addEventListener("input", () => {
      calculateSessionPointsEstimate();
      const minutes = parseInt(minutesInput.value, 10) || 0;
      remainingSeconds = minutes * 60;
      updateTimerDisplay();
    });

    startTimerBtn.addEventListener("click", startTimer);
    pauseTimerBtn.addEventListener("click", pauseTimer);
    resetTimerBtn.addEventListener("click", resetTimer);

    /* ---------- POINTS + LEVELS + OWL ---------- */
    function getLevelInfo(points) {
      if (points >= 250) {
        return {
          level: 4,
          name: "Legendary Math Sage",
          floor: 250,
          cap: 350,
          nextLabel: "Max level (for now!)"
        };
      } else if (points >= 150) {
        return {
          level: 3,
          name: "Algebra Master",
          floor: 150,
          cap: 250,
          nextLabel: `${250 - points} points to Level 4`
        };
      } else if (points >= 50) {
        return {
          level: 2,
          name: "Geometry Pro",
          floor: 50,
          cap: 150,
          nextLabel: `${150 - points} points to Level 3`
        };
      } else {
        return {
          level: 1,
          name: "New Student",
          floor: 0,
          cap: 50,
          nextLabel: `${50 - points} points to Level 2`
        };
      }
    }

    function updateOwlIcon() {
      const baseOwl = "ü¶âüéì";
      const equipped = accessories.filter((a) => a.equipped);
      const extra = equipped.map((a) => a.emoji).join(" ");
      owlIcon.textContent = extra ? baseOwl + " " + extra : baseOwl;
    }

    function updateEquippedAccessoryTags() {
      equippedAccessories.innerHTML = "";
      const equipped = accessories.filter((a) => a.equipped);
      if (equipped.length === 0) {
        const span = document.createElement("span");
        span.className = "accessory-tag";
        span.textContent = "No accessories equipped yet.";
        equippedAccessories.appendChild(span);
        return;
      }
      equipped.forEach((a) => {
        const span = document.createElement("span");
        span.className = "accessory-tag";
        span.innerHTML = `${a.emoji} ${a.name}`;
        equippedAccessories.appendChild(span);
      });
    }

    function updatePointsUI() {
      headerPoints.textContent = totalPoints;
      pointsTag.textContent = "Points: " + totalPoints;

      const levelInfo = getLevelInfo(totalPoints);
      headerLevelChip.textContent = `Level ${levelInfo.level} ¬∑ ${levelInfo.name}`;
      owlLevelText.textContent = `Level ${levelInfo.level} ¬∑ ${levelInfo.name}`;
      owlXpText.textContent = `${totalPoints - levelInfo.floor} / ${
        levelInfo.cap - levelInfo.floor
      } points to next level (${levelInfo.nextLabel})`;

      const range = levelInfo.cap - levelInfo.floor;
      const progress = range > 0 ? ((totalPoints - levelInfo.floor) / range) * 100 : 100;
      levelProgress.style.width = Math.min(100, Math.max(0, progress)) + "%";

      renderShop();
      updateOwlIcon();
      updateEquippedAccessoryTags();
    }

    /* ---------- SHOP LOGIC ---------- */
    function toggleAccessory(id) {
      const item = accessories.find((a) => a.id === id);
      if (!item) return;

      if (!item.owned) {
        if (totalPoints < item.cost) {
          alert("Not enough points for this accessory yet. Keep studying!");
          return;
        }
        if (!confirm(`Buy "${item.name}" for ${item.cost} points?`)) {
          return;
        }
        totalPoints -= item.cost;
        item.owned = true;
        item.equipped = true;
      } else {
        item.equipped = !item.equipped;
      }

      updatePointsUI();
    }

    function renderShop() {
      shopList.innerHTML = "";
      accessories.forEach((item) => {
        const div = document.createElement("div");
        div.className = "shop-item";

        const labelDiv = document.createElement("div");
        labelDiv.className = "shop-label";
        labelDiv.innerHTML = `<span>${item.emoji} ${item.name}</span><span class="hint">${item.description}</span>`;

        const metaRow = document.createElement("div");
        metaRow.className = "shop-meta-row";

        const costSpan = document.createElement("span");
        costSpan.className = "shop-cost";
        costSpan.innerHTML = `‚≠ê ${item.cost} pts`;

        const statusSpan = document.createElement("span");
        statusSpan.className = "shop-status";
        if (item.equipped) {
          statusSpan.classList.add("equipped");
          statusSpan.textContent = "Equipped";
        } else if (item.owned) {
          statusSpan.classList.add("owned");
          statusSpan.textContent = "Owned";
        } else {
          statusSpan.textContent = "Locked";
        }

        const btn = document.createElement("button");
        btn.className = "btn-secondary btn-small btn-shop";
        if (!item.owned) {
          btn.innerHTML = `Buy & Equip <span>‚ûú</span>`;
        } else {
          btn.innerHTML = item.equipped ? `Unequip` : `Equip`;
        }
        btn.addEventListener("click", () => toggleAccessory(item.id));

        metaRow.appendChild(costSpan);
        metaRow.appendChild(statusSpan);

        div.appendChild(labelDiv);
        div.appendChild(metaRow);
        div.appendChild(btn);

        shopList.appendChild(div);
      });
    }

    /* ---------- QUIZ LOGIC ---------- */
    function refreshQuizPreview() {
      if (quizQuestions.length === 0) {
        quizPreview.textContent =
          "No questions yet. Add one above to start your quiz bank.";
        quizRunner.style.display = "none";
        return;
      }

      quizPreview.innerHTML = "";
      quizQuestions.forEach((q, index) => {
        const p = document.createElement("p");
        p.textContent = `${index + 1}. ${q.question} (Correct: ${q.correct})`;
        quizPreview.appendChild(p);
      });
    }

    function addQuestion() {
      const question = quizQuestionInput.value.trim();
      const a = optA.value.trim();
      const b = optB.value.trim();
      const c = optC.value.trim();
      const d = optD.value.trim();
      const correct = correctOptionSelect.value;

      if (!question || !a || !b || !c || !d) {
        alert("Please fill in the question and all four options.");
        return;
      }

      quizQuestions.push({
        question,
        options: { A: a, B: b, C: c, D: d },
        correct
      });

      quizQuestionInput.value = "";
      optA.value = "";
      optB.value = "";
      optC.value = "";
      optD.value = "";
